# Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
#
# Permission is hereby granted, free of charge, to any person obtaining a copy of
# this software and associated documentation files (the "Software"), to deal in
# the Software without restriction, including without limitation the rights to
# use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
# the Software, and to permit persons to whom the Software is furnished to do so.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
# FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
# COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
# IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
# CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

s3_dag:
  dag_id: s3_dag
  default_args:
    start_date: '2024-01-01'
  schedule: None
  tasks:
    create_test_bucket:
      operator: airflow.providers.amazon.aws.operators.s3.S3CreateBucketOperator
      bucket_name: test-bucket-{{ ds_nodash }}
      task_id: create_test_bucket
    create_test_object:
      operator: airflow.providers.amazon.aws.operators.s3.S3CreateObjectOperator
      data: Hello World
      s3_bucket: test-bucket-{{ ds_nodash }}
      s3_key: test-file.txt
      task_id: create_test_object
      replace: true
      dependencies:
      - create_test_bucket
    list_objects:
      operator: airflow.providers.amazon.aws.operators.s3.S3ListOperator
      apply_wildcard: false
      bucket: test-bucket-{{ ds_nodash }}
      delimiter: ''
      task_id: list_objects
      dependencies:
      - wait_for_key
    wait_for_key:
      operator: airflow.providers.amazon.aws.sensors.s3.S3KeySensor
      bucket_key: test-file.txt
      bucket_name: test-bucket-{{ ds_nodash }}
      task_id: wait_for_key
      use_regex: false
      wildcard_match: false
      dependencies:
      - create_test_object
    delete_objects:
      operator: airflow.providers.amazon.aws.operators.s3.S3DeleteObjectsOperator
      bucket: test-bucket-{{ ds_nodash }}
      keys:
      - test-file.txt
      task_id: delete_objects
      dependencies:
      - list_objects
    delete_test_bucket:
      operator: airflow.providers.amazon.aws.operators.s3.S3DeleteBucketOperator
      aws_conn_id: aws_default
      bucket_name: test-bucket-{{ ds_nodash }}
      force_delete: true
      task_id: delete_test_bucket
      trigger_rule: all_done
      dependencies:
      - delete_objects
